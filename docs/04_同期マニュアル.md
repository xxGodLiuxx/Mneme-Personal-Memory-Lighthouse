# Mneme - Personal Memory Lighthouse 同期マニュアル

## 概要

このマニュアルでは、複数のWindows PC間でMnemeのデータを同期する方法を説明します。

### 同期のメリット
- 🏠 自宅PCと職場PCで同じメモリを共有
- 💼 デスクトップとノートPCでシームレスな作業継続
- 🔄 自動バックアップによるデータ保護
- 📱 将来的なモバイルアクセスへの準備

---

## 同期方式の選択

### 推奨: Dropbox同期
- ✅ 設定が簡単
- ✅ リアルタイム同期
- ✅ バージョン履歴機能
- ✅ 選択的同期可能

### 代替案
1. **OneDrive**: Windows統合が強力
2. **Google Drive**: 容量が多い
3. **Git**: バージョン管理に優れる
4. **NAS**: 完全なプライベート環境

## Dropbox同期 詳細手順

### 準備

#### 必要なもの
- Dropboxアカウント（無料版でOK）
- 各PCにDropboxデスクトップアプリ
- 管理者権限（シンボリックリンク作成用）

### メインPC（現在使用中のPC）での設定

#### ステップ1: Dropboxインストール確認
```cmd
dir %USERPROFILE%\Dropbox
```

Dropboxフォルダが存在しない場合は、[Dropbox](https://www.dropbox.com/)からインストール

#### ステップ2: 自動セットアップスクリプト実行

**管理者権限**でコマンドプロンプトを開き：
```cmd
cd /d C:\Users\%USERNAME%\Desktop
setup_sync_main.bat
```

#### ステップ3: 同期確認
1. Dropboxアイコンが同期中を示す
2. `Dropbox\JaH_ThoughtTrace_Sync`フォルダ作成確認
3. ファイルがアップロードされるまで待機

### サブPC（他のWindows PC）での設定

#### ステップ1: 基本セットアップ
1. [セットアップガイド](03_セットアップガイド.md)の手順1-4を実行
2. Dropboxをインストールしてログイン

#### ステップ2: 同期完了待機
Dropboxで以下のファイルが同期されるまで待つ：
- `JaH_ThoughtTrace_Sync\memories.json`
- `JaH_ThoughtTrace_Sync\index.json`
- `JaH_ThoughtTrace_Sync\serendipity_cache.json`

#### ステップ3: シンボリックリンク作成

**管理者権限**でコマンドプロンプトを開き：
```cmd
cd /d C:\Users\%USERNAME%\Desktop
setup_sync_other.bat
```

#### ステップ4: Claude Desktop設定
各PCで同じ手順：
1. `claude_desktop_config.json`を設定
2. Pythonパスは各PC環境に合わせて調整
3. Claude Desktop再起動

## 手動同期設定

自動スクリプトが使えない場合の手動手順：

### メインPCで
```cmd
# 管理者権限で実行
cd C:\Users\%USERNAME%

# Dropboxにデータをコピー
mkdir "%USERPROFILE%\Dropbox\JaH_ThoughtTrace_Sync"
xcopy .jah_thoughttrace "%USERPROFILE%\Dropbox\JaH_ThoughtTrace_Sync" /E /I /Y

# 元のフォルダを削除
rmdir .jah_thoughttrace /S /Q

# シンボリックリンク作成
mklink /D .jah_thoughttrace "%USERPROFILE%\Dropbox\JaH_ThoughtTrace_Sync"
```

### サブPCで
```cmd
# 管理者権限で実行
cd C:\Users\%USERNAME%

# シンボリックリンク作成
mklink /D .jah_thoughttrace "%USERPROFILE%\Dropbox\JaH_ThoughtTrace_Sync"
```

## 同期の確認

### 動作テスト

1. **PC1でメモリ作成**
   ```
   Claude: テスト用のメモリを作成
   ```

2. **Dropbox同期待機**（通常1-2分）

3. **PC2で確認**
   ```
   Claude: 最新のメモリを表示
   ```

### 同期状態の確認方法

#### Dropboxアイコンで確認
- ✅ 緑のチェック: 同期完了
- 🔄 青い矢印: 同期中
- ❌ 赤いX: エラー

#### ファイルタイムスタンプ確認
```cmd
dir "%USERPROFILE%\Dropbox\JaH_ThoughtTrace_Sync\*.json"
```

## トラブルシューティング

### 問題: シンボリックリンク作成エラー

#### 原因と対策
1. **権限不足**: 管理者権限で再実行
2. **既存フォルダ**: 既存の`.jah_thoughttrace`を削除
3. **パス問題**: Dropboxパスを確認

```cmd
# 既存フォルダ削除
rmdir %USERPROFILE%\.jah_thoughttrace /S /Q

# 再度リンク作成
mklink /D .jah_thoughttrace "%USERPROFILE%\Dropbox\JaH_ThoughtTrace_Sync"
```

### 問題: 同期競合

#### 症状
- `memories (conflicted copy).json`が作成される

#### 解決方法
1. 両方のファイルをバックアップ
2. 新しい方を採用
3. 必要に応じて手動マージ

```python
# マージスクリプト（将来実装予定）
python merge_conflicts.py
```

### 問題: 同期遅延

#### 対策
1. Dropbox設定で優先度を上げる
2. LAN同期を有効化
3. 選択的同期で他のフォルダを除外

## ベストプラクティス

### 1. 同時編集の回避

#### ルール
- 一度に1台のPCでのみClaude Desktopを使用
- 作業終了後、同期完了を確認してから次のPCへ

#### 同期完了の確認方法
```cmd
# 最終更新時刻確認
forfiles /P "%USERPROFILE%\Dropbox\JaH_ThoughtTrace_Sync" /M *.json /C "cmd /c echo @file @fdate @ftime"
```

### 2. 定期バックアップ

#### 自動バックアップスクリプト
```batch
@echo off
set BACKUP_DIR=D:\Backup\JaH_ThoughtTrace
set TODAY=%DATE:~0,4%%DATE:~5,2%%DATE:~8,2%

mkdir "%BACKUP_DIR%\%TODAY%" 2>nul
xcopy "%USERPROFILE%\Dropbox\JaH_ThoughtTrace_Sync" "%BACKUP_DIR%\%TODAY%" /E /I /Y

echo Backup completed: %BACKUP_DIR%\%TODAY%
```

週次でタスクスケジューラに登録推奨

### 3. 同期状態モニタリング

#### PowerShellスクリプト
```powershell
# sync_monitor.ps1
$syncFolder = "$env:USERPROFILE\Dropbox\JaH_ThoughtTrace_Sync"

Get-ChildItem $syncFolder -Filter "*.json" | ForEach-Object {
    Write-Host "$($_.Name): $($_.LastWriteTime)"
}

# ファイルサイズ合計
$totalSize = (Get-ChildItem $syncFolder -Recurse | Measure-Object -Property Length -Sum).Sum / 1MB
Write-Host "Total size: $([math]::Round($totalSize, 2)) MB"
```

## 高度な同期設定

### 選択的同期

大きなメモリデータベースの場合：

1. Dropbox設定を開く
2. 「選択型同期」を選択
3. `JaH_ThoughtTrace_Sync`のみチェック

### 帯域幅制限

```
Dropbox設定 > 帯域幅 > ダウンロード/アップロード速度を制限
```

### オフライン作業

1. 機内モードでも動作継続
2. オンライン復帰時に自動同期
3. 競合は自動的に別名保存

## セキュリティ考慮事項

### データ暗号化

#### Dropbox側
- 転送時: SSL/TLS暗号化
- 保存時: AES-256暗号化

#### 追加の暗号化（オプション）
```cmd
# 7-Zipで暗号化アーカイブ作成
"C:\Program Files\7-Zip\7z.exe" a -p"your-password" -mhe=on backup.7z "%USERPROFILE%\.jah_thoughttrace"
```

### アクセス制御

1. **2段階認証**: Dropboxアカウントで有効化
2. **デバイス制限**: 信頼できるPCのみリンク
3. **共有禁止**: JaH_ThoughtTrace_Syncフォルダは非共有

## 将来の拡張

### モバイルアクセス

現在のJSON形式なら、将来的に：
- iOSショートカットで読み取り可能
- Androidアプリ開発可能
- Web版ビューアー作成可能

### 他クラウドへの移行

データはポータブル：
```cmd
# Dropboxから別クラウドへ
xcopy "%USERPROFILE%\Dropbox\JaH_ThoughtTrace_Sync" "%USERPROFILE%\OneDrive\JaH_ThoughtTrace_Sync" /E /I /Y
```

## まとめ

### 同期設定チェックリスト

- [ ] Dropboxインストール済み（全PC）
- [ ] メインPCでsetup_sync_main.bat実行
- [ ] Dropbox同期完了確認
- [ ] サブPCでsetup_sync_other.bat実行
- [ ] 各PCでClaude Desktop設定
- [ ] 動作テスト完了
- [ ] バックアップ設定

### 日常運用

1. **作業開始時**: 同期状態確認
2. **作業中**: 自動同期に任せる
3. **作業終了時**: 同期完了待機
4. **週次**: バックアップ確認

---

*同期により、あなたの思考と記憶は場所を選ばず、いつでもアクセス可能になります。*